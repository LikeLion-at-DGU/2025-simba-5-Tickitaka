{% extends 'test-base.html' %} {% load static %} {% block content %}
<link rel="stylesheet" href="{% static 'css/post_detail.css' %}" />
<link rel="stylesheet" href="{% static 'css/reset.css' %}">

<body>
    <div class="post-detail-container_sy">

        <div class="post-detail-header_sy">
            <div class="go-back-btn_sy" onclick="window.location.href='{% url 'posts:post_list' %}'">
                <svg width="8" height="13" viewBox="0 0 8 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd"
                        d="M0.29277 5.79301L5.94977 0.136013L7.36377 1.55001L2.41377 6.50001L7.36377 11.45L5.94977 12.864L0.29277 7.20701C0.105299 7.01949 -1.66893e-05 6.76518 -1.66893e-05 6.50001C-1.66893e-05 6.23485 0.105299 5.98054 0.29277 5.79301Z"
                        fill="black" />
                </svg>
            </div>
            <div class="complain-btn_sy">
                {% comment %}
                <!--<a href="{% url 'posts:report_post' post.id %}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="..." fill="#C75352" />
                    </svg>
                    <p>신고하기</p>
                </a>-->
                {% endcomment %}
            </div>
        </div>

        <div class="post-detail-content_sy">
            <div class="post-detail-image_sy">
                <button class="carousel-btn left" onclick="prevImage()"></button>
                <div class="carousel-track_sy">
                    {% for image in post.images.all %}
                        <img src="{{ image.image.url }}" alt="post image" class="carousel-image_sy">
                    {% empty %}
                        <img src="{% static 'images/test2.png' %}" alt="기본 이미지" class="carousel-image_sy">
                    {% endfor %}
                </div>
                <button class="carousel-btn right" onclick="nextImage()">›</button>
            </div>
            <div class="post-detail-item_sy">
                <div class="user-info_sy">
                    <div class="profile-image_sy">
                            {% for image in post.images.all %}
                                <img src="{{ image.image.url }}" alt="post image">
                            {% endfor %}
                    </div>
                    <div class="user-name_sy">{{ post.master.nickname }}</div>
                </div>

                <div class="line_sy"></div>

                <div class="post-detail">

                    <div class="first-detail_sy">
                        <P class="post-title_sy">{{ post.title }}</P>
                        <p class="post-time-text_sy">{{ post.amounts }}분</p>
                    </div>

                    <div class="second-detail_sy">

                        <div class="third-detail_sy">
                            <div class="post-detail-time_sy">
                                <svg width="18" height="18" viewBox="0 0 18 18" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M8.99995 16.5C8.06245 16.5 7.18445 16.322 6.36595 15.966C5.54745 15.61 4.83495 15.1287 4.22845 14.5222C3.62195 13.9157 3.1407 13.2032 2.7847 12.3847C2.4287 11.5662 2.25045 10.688 2.24995 9.74995C2.24945 8.81195 2.4277 7.93395 2.7847 7.11595C3.1417 6.29795 3.6227 5.58545 4.2277 4.97845C4.8327 4.37145 5.5452 3.8902 6.3652 3.5347C7.1852 3.1792 8.06345 3.00095 8.99995 2.99995C9.93645 2.99895 10.8147 3.1772 11.6347 3.5347C12.4547 3.8922 13.1672 4.37345 13.7722 4.97845C14.3772 5.58345 14.8584 6.29595 15.216 7.11595C15.5735 7.93595 15.7514 8.81395 15.7499 9.74995C15.7484 10.686 15.5704 11.5642 15.216 12.3847C14.8615 13.2052 14.3802 13.9177 13.7722 14.5222C13.1642 15.1267 12.4517 15.608 11.6347 15.966C10.8177 16.324 9.93945 16.502 8.99995 16.5ZM11.0999 12.9L12.15 11.85L9.74995 9.44995V5.99995H8.24995V10.05L11.0999 12.9ZM4.19995 1.76245L5.24995 2.81245L2.06245 5.99995L1.01245 4.94995L4.19995 1.76245ZM13.7999 1.76245L16.9874 4.94995L15.9374 5.99995L12.75 2.81245L13.7999 1.76245Z"
                                        fill="black" />
                                </svg>
                                <p>{{ post.deadline|date:"m/d H:i" }}까지</p>
                            </div>
                            <div class="status-button_sy">
                                {% if post.status == "waiting" %}
                                <button class="status-blue_sy">거래전</button>
                                {% elif post.status == "chatting" or post.status == "in_progress" %}
                                <button class="status-red_sy">거래중</button>
                                {% elif post.status == "done" %}
                                <button class="status-green_sy">거래완료</button>
                                {% endif %}
                            </div>
                        </div>

                        <div class="post-detail-location_sy">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                    d="M16.272 10.2722C16.272 11.3331 15.8506 12.3505 15.1005 13.1006C14.3503 13.8508 13.3329 14.2722 12.272 14.2722C11.2112 14.2722 10.1938 13.8508 9.44361 13.1006C8.69346 12.3505 8.27203 11.3331 8.27203 10.2722C8.27203 9.21135 8.69346 8.19394 9.44361 7.44379C10.1938 6.69364 11.2112 6.27222 12.272 6.27222C13.3329 6.27222 14.3503 6.69364 15.1005 7.44379C15.8506 8.19394 16.272 9.21135 16.272 10.2722ZM14.272 10.2722C14.272 10.8027 14.0613 11.3114 13.6862 11.6864C13.3112 12.0615 12.8025 12.2722 12.272 12.2722C11.7416 12.2722 11.2329 12.0615 10.8578 11.6864C10.4827 11.3114 10.272 10.8027 10.272 10.2722C10.272 9.74178 10.4827 9.23308 10.8578 8.858C11.2329 8.48293 11.7416 8.27222 12.272 8.27222C12.8025 8.27222 13.3112 8.48293 13.6862 8.858C14.0613 9.23308 14.272 9.74178 14.272 10.2722Z"
                                    fill="black" />
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                    d="M5.794 16.5181C4.50484 15.2907 3.60861 13.7085 3.21864 11.9717C2.82867 10.2349 2.96248 8.42149 3.60315 6.76074C4.24381 5.1 5.36256 3.66652 6.81792 2.6416C8.27328 1.61668 9.99988 1.04634 11.7794 1.00271C13.5589 0.959071 15.3114 1.4441 16.8152 2.39646C18.3191 3.34882 19.5067 4.72574 20.228 6.35309C20.9493 7.98044 21.1718 9.78514 20.8675 11.539C20.5631 13.2928 19.7455 14.917 18.518 16.2061L12.312 22.7241L5.794 16.5181ZM17.07 14.8271L12.243 19.8971L7.173 15.0701C6.17037 14.1154 5.47334 12.8849 5.17005 11.5341C4.86676 10.1833 4.97084 8.77285 5.46912 7.48119C5.9674 6.18953 6.8375 5.07462 7.96941 4.27746C9.10131 3.4803 10.4442 3.03668 11.8282 3.00269C13.2122 2.96871 14.5752 3.3459 15.7449 4.08655C16.9146 4.8272 17.8383 5.89806 18.3994 7.16371C18.9605 8.42936 19.1336 9.83297 18.897 11.197C18.6604 12.5611 18.0246 13.8244 17.07 14.8271Z"
                                    fill="black" />
                            </svg>

                            <p class="post-location_sy">{{ post.building.name }}</p>

                        </div>
                    </div>



                    <div class="fourth-detail_sy">
                        <p>{{ post.content }}</p>
                    </div>

                </div>

                <div class="line_sy"></div>

                <div class="post-detail-footer_sy">
                    <form method="POST" action="{% url 'posts:toggle_saved' post.id %}" class="post-liked_sy">
                        {% csrf_token %}
                        <button type="submit" style="all:unset; cursor:pointer;">
                            <svg xmlns="http://www.w3.org/2000/svg"
                                width="16" height="21" viewBox="0 0 16 21"
                                fill="{% if is_saved %}black{% else %}none{% endif %}" stroke="black">
                                <path d="M15.5 1V19.749L8.19238 16.7051L8 16.625L7.80762 16.7051L0.5 19.749V1H15.5Z"/>
                            </svg>
                        </button>
                        <p class="post-liked-count_sy">{{ post.saved_count }}</p>
                    </form>
                    
                    {% if user.id == post.master_id %}
                    <div class="manage-btn-wrapper_sy">
                        {# 작성자일 경우: 수정/삭제 버튼 #}

                        {% if post.status == "waiting" %}
                        <a href="{% url 'posts:post_update' post.id %}">
                            <button class="edit-btn_sy">수정하기</button>
                        </a>
                        <form method="POST" action="{% url 'posts:post_delete' post.id %}" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" class="delete-btn_sy" onclick="return confirm('정말 삭제하시겠습니까?');">삭제하기</button>
                        </form>
                        {% else %}
                        <button class="edit-btn_sy" disabled>수정하기</button>
                        <button class="edit-btn_sy" disabled>삭제하기</button>
                        {% endif %}
                    </div>
                    {% else %}
                    {# 작성자가 아닌 일반 사용자 #}
                    {% if post.status == "waiting" %}
                    <form method="POST" action="{% url 'posts:call_post' post.id %}">
                        {% csrf_token %}
                        <button class="call-btn_sy" type="submit">콜!</button>
                    </form>
                    {% else %}
                    <button class="call-btn_sy disabled" disabled>콜!</button>
                    {% endif %}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</body>

{% endblock %}
{% block scripts %}

<script src="{% static 'js/post_detail.js' %}"></script>

{% endblock %}